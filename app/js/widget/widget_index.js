function gotoPin(e){var t=document.getElementsByClassName("pin");Common.addClass(t[e],"current")}(function(){"use strict";function e(e,t){var n=[],o=this.options;return o.onProgress&&e&&o.onProgress.call(this,e,t,this.completed.length),this.completed.length+this.errors.length===this.queue.length&&(n.push(this.completed),this.errors.length&&n.push(this.errors),o.onComplete.apply(this,n)),this}var t="addEventListener"in new Image,n=function(e,t){this.options={pipeline:!1,auto:!0,prefetch:!1,onComplete:function(){}},t&&"object"==typeof t&&this.setOptions(t),this.addQueue(e),this.queue.length&&this.options.auto&&this.processQueue()};n.prototype.setOptions=function(e){var t,n=this.options;for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return this},n.prototype.addQueue=function(e){return this.queue=e.slice(),this},n.prototype.reset=function(){return this.completed=[],this.errors=[],this},n.prototype.addEvents=function(n,o,i){var s=this,a=this.options,r=function(){t?(this.removeEventListener("error",l),this.removeEventListener("abort",l),this.removeEventListener("load",d)):this.onerror=this.onabort=this.onload=null},l=function(){r.call(this),s.errors.push(o),a.onError&&a.onError.call(s,o),e.call(s,o),a.pipeline&&s.loadNext(i)},d=function(){r.call(this),s.completed.push(o),e.call(s,o,this),a.pipeline&&s.loadNext(i)};t?(n.addEventListener("error",l,!1),n.addEventListener("abort",l,!1),n.addEventListener("load",d,!1)):(n.onerror=n.onabort=l,n.onload=d)},n.prototype.load=function(e,t){var n=new Image;return this.addEvents(n,e,t),n.src=e,this},n.prototype.loadNext=function(e){return e++,this.queue[e]&&this.load(this.queue[e],e),this},n.prototype.processQueue=function(){var e=0,t=this.queue,n=t.length;if(this.reset(),this.options.pipeline)this.load(t[0],0);else for(;n>e;++e)this.load(t[e],e);return this},"function"==typeof define&&define.amd?define(function(){return n}):this.preLoader=n}).call(this),function(e,t){"function"==typeof define&&define.amd?define(function(){return t(e,e.document)}):"undefined"!=typeof module&&module.exports?module.exports=t(e,e.document):e.Shake=t(e,e.document)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function n(n){if(this.hasDeviceMotion="ondevicemotion"in e,this.options={threshold:15,timeout:1e3},"object"==typeof n)for(var o in n)n.hasOwnProperty(o)&&(this.options[o]=n[o]);if(this.lastTime=new Date,this.lastX=null,this.lastY=null,this.lastZ=null,"function"==typeof t.CustomEvent)this.event=new t.CustomEvent("shake",{bubbles:!0,cancelable:!0});else{if("function"!=typeof t.createEvent)return!1;this.event=t.createEvent("Event"),this.event.initEvent("shake",!0,!0)}}return n.prototype.reset=function(){this.lastTime=new Date,this.lastX=null,this.lastY=null,this.lastZ=null},n.prototype.start=function(){this.reset(),this.hasDeviceMotion&&e.addEventListener("devicemotion",this,!1)},n.prototype.stop=function(){this.hasDeviceMotion&&e.removeEventListener("devicemotion",this,!1),this.reset()},n.prototype.devicemotion=function(t){var n,o,i=t.accelerationIncludingGravity,s=0,a=0,r=0;return null===this.lastX&&null===this.lastY&&null===this.lastZ?(this.lastX=i.x,this.lastY=i.y,void(this.lastZ=i.z)):(s=Math.abs(this.lastX-i.x),a=Math.abs(this.lastY-i.y),r=Math.abs(this.lastZ-i.z),(s>this.options.threshold&&a>this.options.threshold||s>this.options.threshold&&r>this.options.threshold||a>this.options.threshold&&r>this.options.threshold)&&(n=new Date,o=n.getTime()-this.lastTime.getTime(),o>this.options.timeout&&(e.dispatchEvent(this.event),this.lastTime=new Date)),this.lastX=i.x,this.lastY=i.y,void(this.lastZ=i.z))},n.prototype.handleEvent=function(e){return"function"==typeof this[e.type]?this[e.type](e):void 0},n}),function(e,t){var n=e.documentElement,o="orientationchange"in window?"orientationchange":"resize",i=function(){var e=n.clientWidth;window.innerHeight;e&&(n.style.fontSize=50*(e/375)+"px")};e.addEventListener&&(t.addEventListener(o,i,!1),i())}(document,window),function(){var e=(navigator.userAgent.toLowerCase(),{ajax:function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(200===n.status)return t(n.response);console.error(n.statusText)}},n.onerror=function(){console.log("请求报错")},n.open(e.type,e.url,!0),n.setRequestHeader("Content-Type","application/json"),n.responseType="application/json",n.send(JSON.stringify(e.data))},hasClass:function(e,t){return t=t||"",0==t.replace(/\s/g,"").length?!1:new RegExp(" "+t+" ").test(" "+e.className+" ")},addClass:function(e,t){var n=this;n.hasClass(e,t)||(e.className=""==e.className?t:e.className+" "+t)},removeClass:function(e,t){var n=this;if(n.hasClass(e,t)){for(var o=" "+e.className.replace(/[\t\r\n]/g,"")+" ";o.indexOf(" "+t+" ")>=0;)o=o.replace(" "+t+" "," ");e.className=o.replace(/^\s+|\s+$/g,"")}},goHomepage:function(){gotoPin(0)},msgBox:function(e,t){t?$("body").append('<div class="ajaxpop msgbox minwidthbox"><div class="loading">'+e+"</div></div>"):$("body").append('<div class="ajaxpop msgbox"><div class="loading"><div class="icon-loading"></div>'+e+"</div></div>")},errorMsg:{add:function(e,t){for(var n in e.childNodes){if("error"==e.childNodes[n].className)return e.childNodes[n].textContent=t,!0;if(n==e.childNodes.length-1){var o=document.createElement("div");o.textContent=t,o.className="error",e.appendChild(o)}}},remove:function(e){for(var t in e.childNodes)if("error"==e.childNodes[t].className)return void e.childNodes[t].parentNode.removeChild(e.childNodes[t])}}});this.Common=e}.call(this),Api={isLogin:function(e){Common.ajax({url:"/api/islogin",type:"POST"},function(t){return e(t)})},getKeycode:function(e,t){Common.ajax({url:"/api/check",type:"POST",data:e},function(e){return t(e)})},submitAll:function(e,t){Common.ajax({url:"/api/submit",type:"POST",data:e},function(e){return t(e)})},submitWithoutChecknum:function(e,t){Common.ajax({url:"/api/submit2",type:"POST",data:e},function(e){return t(e)})},getRedpacket:function(e,t){Common.ajax({url:"/api/getredpacket",type:"POST",data:e},function(e){return t(e)})}},function(){"use strict";var e=function(){this.curPage=0,this.selectedColor="",this.isShake=!1,this.hasLogged=!1};e.prototype={init:function(){var e=this,t="/app",n=[t+"/images/logo.png",t+"/images/p1-2.png",t+"/images/p1-3.png",t+"/images/p1-4.png",t+"/images/p1-bg.png",t+"/images/p2-bg.png",t+"/images/p2-pop-text.png",t+"/images/p3-bg.png",t+"/images/btn-getkeycode.png",t+"/images/btn-getmoney.png",t+"/images/button-ok.png",t+"/images/follow-text.png",t+"/images/input-border.png",t+"/images/link-privacy.png",t+"/images/money.png",t+"/images/qrcode-follow.png",t+"/images/shake-text.png",t+"/images/tips.png",t+"/images/tips-text.png",t+"/images/yuan.png"];new preLoader(n,{onProgress:function(){},onComplete:function(){document.getElementsByClassName("preloading")[0].remove(),Common.removeClass(document.getElementsByClassName("tips-pop")[0],"hide"),e.bindEvent()}})},bindEvent:function(){var e=this,t=document.getElementsByClassName("btn-tips-yes")[0];t.addEventListener("touchstart",function(){Common.addClass(t.parentElement.parentElement,"hide"),Api.isLogin(function(t){1==t.status?(console.log(t.msg.money),gotoPin(t.msg.money>0?2:0),t.msg.mobile?e.hasLogged=!0:e.hasLogged=!1):0==t.status&&(window.location.href="http://oauth.curio.im/v1/wx/web/auth/29b95ed3-502b-4c44-9084-b978b287c1fb")})});var n=document.getElementsByClassName("btn-tips-no")[0];n.addEventListener("touchstart",function(){WeixinJSBridge.call("closeWindow")}),e.isShake=!0;var o=new Shake({threshold:15});o.start(),window.addEventListener("shake",function(){e.isShake&&(e.shake(),e.isShake=!1)},!1),"ondevicemotion"in window||alert("Not Supported"),e.SubmitKeycodeForm();var i=document.getElementById("btn-getredpacket"),s=!0;i.addEventListener("touchstart",function(){s&&(s=!1,e.getRedpacket())});var a=document.getElementsByClassName("privacy-term")[0];a.addEventListener("touchstart",function(){Common.removeClass(document.getElementsByClassName("term-pop")[0],"hide")}),document.getElementsByClassName("btn-close")[0].addEventListener("touchstart",function(){Common.addClass(document.getElementsByClassName("term-pop")[0],"hide")})},shake:function(){var e=this,t=document.getElementById("input-phone");e.hasLogged&&(document.getElementById("input-keycode").parentNode.style.display="none",t.value=data.msg.mobile,t.disabled=!0),gotoPin(1)},MobileValidate:function(){var e=!0,t=document.getElementById("input-phone");if(t.value){var n=/^1\d{10}$/;n.test(t.value)?Common.errorMsg.remove(t.parentElement):(e=!1,Common.errorMsg.add(t.parentElement,"手机号格式错误，请重新输入"))}else Common.errorMsg.add(t.parentElement,"手机号码不能为空"),e=!1;return!!e},FormKeycodeValidate:function(){var e=this,t=!0,n=document.getElementById("input-phone"),o=document.getElementById("input-keycode"),i=document.getElementById("input-coupon");if(n.value){var s=/^1\d{10}$/;s.test(n.value)?Common.errorMsg.remove(n.parentElement):(t=!1,Common.errorMsg.add(n.parentElement,"手机号格式错误，请重新输入"))}else Common.errorMsg.add(n.parentElement,"手机号码不能为空"),t=!1;return e.hasLogged||(o.value?Common.errorMsg.remove(o.parentElement):(Common.errorMsg.add(o.parentElement,"验证码不能为空"),t=!1)),i.value?Common.errorMsg.remove(i.parentElement):(Common.errorMsg.add(i.parentElement,"兑换码不能为空"),t=!1),!!t},SubmitKeycodeForm:function(){var e=this,t=!0,n=document.getElementsByClassName("btn-getkeycode")[0],o=document.getElementById("input-phone");n.addEventListener("touchstart",function(i){if(i.preventDefault(),e.MobileValidate()){if(!t)return;t=!1;var s=o.value;Common.hasClass(n,"countdown")||(e.countDown(),Api.getKeycode({mobile:s},function(e){console.log(e),t=!0}))}});var i=document.getElementsByClassName("btn-submit")[0],s=!0;i.addEventListener("touchstart",function(){if(e.FormKeycodeValidate()){if(!s)return;s=!1;var t=document.getElementById("input-phone").value,n=document.getElementById("input-keycode").value,o=document.getElementById("input-coupon").value;e.hasLogged?Api.submitWithoutChecknum({mobile:t,code:o},function(e){s=!0,console.log("submitWithoutChecknum"),gotoPin(2)}):Api.submitAll({mobile:t,checknum:n,code:o},function(e){s=!0,console.log("submitAll"),gotoPin(2)})}})},countDown:function(){var e=59,t=document.getElementsByClassName("btn-getkeycode")[0],n=setInterval(function(){e--,Common.addClass(t,"countdown"),t.innerHTML=e,0>=e&&(clearInterval(n),Common.removeClass(t,"countdown"),t.innerHTML="")},1e3)},getRedpacket:function(){Api.getRedpacket({},function(e){console.log(getRedpacket),1==e.msg.code||2==e.msg.code&&Common.removeClass(document.getElementsByClassName("qrcode-pop")[0],"hide")})},compareCommand:function(e){}},"function"==typeof define&&define.amd?define(function(){return e}):this.controller=e}.call(this),window.onload=function(){var e=new controller;e.init()};